// Code generated by goa v2.0.0-wip, DO NOT EDIT.
//
// secured_service GRPC server
//
// Command:
// $ goa gen goa.design/goa/examples/security/design -o
// $(GOPATH)/src/goa.design/goa/examples/security

package server

import (
	"context"

	"goa.design/goa"
	"goa.design/goa/examples/security/gen/grpc/secured_service/pb"
	securedservice "goa.design/goa/examples/security/gen/secured_service"
	goagrpc "goa.design/goa/grpc"
	"google.golang.org/grpc/codes"
)

// Server implements the pb.SecuredServiceServer interface.
type Server struct {
	SigninH           goagrpc.UnaryHandler
	SecureH           goagrpc.UnaryHandler
	DoublySecureH     goagrpc.UnaryHandler
	AlsoDoublySecureH goagrpc.UnaryHandler
}

// ErrorNamer is an interface implemented by generated error structs that
// exposes the name of the error as defined in the expr.
type ErrorNamer interface {
	ErrorName() string
}

// New instantiates the server struct with the secured_service service
// endpoints.
func New(e *securedservice.Endpoints, uh goagrpc.UnaryHandler) *Server {
	return &Server{
		SigninH:           NewSigninHandler(e.Signin, uh),
		SecureH:           NewSecureHandler(e.Secure, uh),
		DoublySecureH:     NewDoublySecureHandler(e.DoublySecure, uh),
		AlsoDoublySecureH: NewAlsoDoublySecureHandler(e.AlsoDoublySecure, uh),
	}
}

// NewSigninHandler creates a gRPC handler which serves the "secured_service"
// service "signin" endpoint.
func NewSigninHandler(endpoint goa.Endpoint, h goagrpc.UnaryHandler) goagrpc.UnaryHandler {
	if h == nil {
		h = goagrpc.NewUnaryHandler(endpoint, DecodeSigninRequest, EncodeSigninResponse)
	}
	return h
}

// Signin implements the "Signin" method in pb.SecuredServiceServer interface.
func (s *Server) Signin(ctx context.Context, message *pb.SigninRequest) (*pb.SigninResponse, error) {
	ctx = context.WithValue(ctx, goa.MethodKey, "signin")
	ctx = context.WithValue(ctx, goa.ServiceKey, "secured_service")
	resp, err := s.SigninH.Handle(ctx, message)
	if err != nil {
		if en, ok := err.(ErrorNamer); ok {
			switch en.ErrorName() {
			case "unauthorized":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			}
		}
		return nil, goagrpc.EncodeError(err)
	}
	return resp.(*pb.SigninResponse), nil
}

// NewSecureHandler creates a gRPC handler which serves the "secured_service"
// service "secure" endpoint.
func NewSecureHandler(endpoint goa.Endpoint, h goagrpc.UnaryHandler) goagrpc.UnaryHandler {
	if h == nil {
		h = goagrpc.NewUnaryHandler(endpoint, DecodeSecureRequest, EncodeSecureResponse)
	}
	return h
}

// Secure implements the "Secure" method in pb.SecuredServiceServer interface.
func (s *Server) Secure(ctx context.Context, message *pb.SecureRequest) (*pb.SecureResponse, error) {
	ctx = context.WithValue(ctx, goa.MethodKey, "secure")
	ctx = context.WithValue(ctx, goa.ServiceKey, "secured_service")
	resp, err := s.SecureH.Handle(ctx, message)
	if err != nil {
		if en, ok := err.(ErrorNamer); ok {
			switch en.ErrorName() {
			case "invalid-scopes":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			case "unauthorized":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			}
		}
		return nil, goagrpc.EncodeError(err)
	}
	return resp.(*pb.SecureResponse), nil
}

// NewDoublySecureHandler creates a gRPC handler which serves the
// "secured_service" service "doubly_secure" endpoint.
func NewDoublySecureHandler(endpoint goa.Endpoint, h goagrpc.UnaryHandler) goagrpc.UnaryHandler {
	if h == nil {
		h = goagrpc.NewUnaryHandler(endpoint, DecodeDoublySecureRequest, EncodeDoublySecureResponse)
	}
	return h
}

// DoublySecure implements the "DoublySecure" method in pb.SecuredServiceServer
// interface.
func (s *Server) DoublySecure(ctx context.Context, message *pb.DoublySecureRequest) (*pb.DoublySecureResponse, error) {
	ctx = context.WithValue(ctx, goa.MethodKey, "doubly_secure")
	ctx = context.WithValue(ctx, goa.ServiceKey, "secured_service")
	resp, err := s.DoublySecureH.Handle(ctx, message)
	if err != nil {
		if en, ok := err.(ErrorNamer); ok {
			switch en.ErrorName() {
			case "invalid-scopes":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			case "unauthorized":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			}
		}
		return nil, goagrpc.EncodeError(err)
	}
	return resp.(*pb.DoublySecureResponse), nil
}

// NewAlsoDoublySecureHandler creates a gRPC handler which serves the
// "secured_service" service "also_doubly_secure" endpoint.
func NewAlsoDoublySecureHandler(endpoint goa.Endpoint, h goagrpc.UnaryHandler) goagrpc.UnaryHandler {
	if h == nil {
		h = goagrpc.NewUnaryHandler(endpoint, DecodeAlsoDoublySecureRequest, EncodeAlsoDoublySecureResponse)
	}
	return h
}

// AlsoDoublySecure implements the "AlsoDoublySecure" method in
// pb.SecuredServiceServer interface.
func (s *Server) AlsoDoublySecure(ctx context.Context, message *pb.AlsoDoublySecureRequest) (*pb.AlsoDoublySecureResponse, error) {
	ctx = context.WithValue(ctx, goa.MethodKey, "also_doubly_secure")
	ctx = context.WithValue(ctx, goa.ServiceKey, "secured_service")
	resp, err := s.AlsoDoublySecureH.Handle(ctx, message)
	if err != nil {
		if en, ok := err.(ErrorNamer); ok {
			switch en.ErrorName() {
			case "invalid-scopes":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			case "unauthorized":
				return nil, goagrpc.NewStatusError(codes.Unauthenticated, err)
			}
		}
		return nil, goagrpc.EncodeError(err)
	}
	return resp.(*pb.AlsoDoublySecureResponse), nil
}
